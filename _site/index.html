<!DOCTYPE html>
<html>    
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width initial-scale=1">

  <title>The Negative.Zone</title>
  <meta name="description" content="The Crossroads of Infinity
">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://localhost:4000/">
  <link rel="alternate" type="application/atom+xml" title="The Negative.Zone" href="http://localhost:4000/feed.xml" />
  <script src="/scripts/jquery-3.2.1.min.js"></script>
  <script src="/scripts/pithy.js"></script>
</head>


  <body>
    <header class="header">
	<div class="header-container">
		<div class="nav">
			
			<span class="title">
				<li>
					<a href="/index.html">home</a>
				</li>
			</span>			
			
			
				<li>
					<a href="/archive.html">archive</a>
				</li>			
			
			
				<li>
					<a href="/category.html">category</a>
				</li>			
			
			
				<li>
					<a href="/about.html">about</a>
				</li>			
			
		</div>
		<div class="description"> The Crossroads of Infinity </div>		
		<ul class="social-links">
			<li>
				<a href="https://github.com/Kvetch" title="Github">
					<img width="19px" height="19px" src="/images/github.png"/>
				</a>
			</li>
			<li>
				<a href="/feed.xml" title="RSS">
					<img width="19px" height="19px" src="/images/rss.png"/>
				</a>
			</li>
			<li>
				<a href="https://twitter.com/NBaronian" title="Twitter">
					<img width="19px" height="19px" src="/images/twitter.png"/>
				</a>
			</li>
		</ul>		
	</div>
</header>

    <br>
    <div class="page-content">
      <div class="wrapper">
        <div class="home">
  <ul class="post-list">
    
      <li>
        <br>
        <h3>
          <a class="post-link" href="/malware/2017/05/08/Analyzing-Endpoints-With-ELK.html">Analyzing Endpoints With ELK</a>
        </h3>
        <span class="post-meta">May 8, 2017</span>
        <hr id="line">
		<div class="content">
		<p>In this post I will cover my analysis setup in regards to how I have mine configured to capture and consume Sysmon(Windows Logs), Packetbeat, Bro and Procmon.  Everyone loves the SysInternals Suite.  It comes with an amazing array of analysis tools that have all held the test of time.  As with most folks who using the tool suite, <a href="https://technet.microsoft.com/en-us/sysinternals/processmonitor.aspx" title="Procmon" target="_blank">Process Monitor</a> is likely in their top 3 favorites.  Those that use Procmon regularly likely have their favorite filters and perhaps tools.  Many folks use tools like <a href="https://github.com/Rurik/Noriben" target="_blank">Noriben</a> to get quick hits when running malicious binaries.  Noriben is an amazing script that allows you to run Noriben, run your malicious executable and then stop Noriben and review the parsed Procmon output.  As always, there’s more than one way to skin a <a href="http://www.worldwidewords.org/qa/qa-mor1.htm" target="_blank">cat</a> and because I like using ELK for filtering out some of my analysis, I thought I would take a crack at parsing Procmon with Logstash.  Everyone has different setups, so I won’t touch on how you execute Procmon (vmrun), filters you may want to keep local to Procmon or where you save the output, although I will mention saving to a location like a VM shared folder so Logstash or Beats can read is likely ideal.</p>


        </div>
		<br>
      </li>
    
      <li>
        <br>
        <h3>
          <a class="post-link" href="/incident%20response/2017/03/02/Memory-Analysis-of-MMC20.Application-Lateral-Movement.html">Memory Analysis of DCOM Lateral Movement Using MMC20.Application</a>
        </h3>
        <span class="post-meta">Mar 2, 2017</span>
        <hr id="line">
		<div class="content">
		<p>Continuing my analysis of lateral movement using MMC20.Application (see my <a href="http://thenegative.zone/blog/MMC20.Application-Lateral-Movement-Analysis" title="Analyzing MMC20.Application Lateral Movement">previous post</a>), the next logical course was to look in memory and see what I can find.  This post will cover my memory findings.  I will note that I performed this MMC20.Application abuse and then waited a little while before actually capturing memory.</p>


        </div>
		<br>
      </li>
    
      <li>
        <br>
        <h3>
          <a class="post-link" href="/incident%20response/2017/02/04/MMC20.Application-Lateral-Movement-Analysis.html">Analysis of DCOM Lateral Movement Using MMC20.Application</a>
        </h3>
        <span class="post-meta">Feb 4, 2017</span>
        <hr id="line">
		<div class="content">
		<p>The other month I read enigma0x3’s <a href="https://enigma0x3.net/2017/01/05/lateral-movement-using-the-mmc20-application-com-object/" title="enigma0x3.net">excellent post</a> on using MMC20.Application for lateral movement.  The MMC20.Application class allows for the interaction and automation of MMC.  In enigma0x3’s post he leverages the MMC20.Application class using one of the ActiveView View methods to execute a shell command of his choosing, calc.exe in this instance.<br />
This got me thinking how would I spot this lateral movement method on one of my networks.  Clearly, it doesn’t stand out like psexec or some odd service or scheduled task starting up for the first time or at a strange time.  So I figured I would test it out myself and see what artifacts I can see.<br />
So let’s poke around and see what we can see.  For my testing, I have 3 boxes running, a Windows 10 system named Baluur, a Windows 7 named Arthros and then a Domain Controller aptly named TheCrossRoadsOfInfinity.  All machine are part of thenegative.zone domain.  All boxes are also remotely logging sysmon to an ELK stack.  For the scenario, we are going to pretend the attacker has a foothold on the Windows 10 system and is now looking to pivot off their newly found access to another machine.  In this case, the Windows 7 system is the target.</p>


        </div>
		<br>
      </li>
    
  </ul>
</div>

      </div>
    </div>
    
    <footer class="footer">
  <div id="gotop">^</div>
  <br>
  
  
  <br>
	@2017 Nick Baronian - Kvetch
  <script>
    var _gaq = _gaq || [];
    var pluginUrl =
   '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
    _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
    _gaq.push(['_setAccount', 'UA-91327667-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
</footer>

    
  </body>

</html>
